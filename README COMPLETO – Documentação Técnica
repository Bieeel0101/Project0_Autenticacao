
# Projeto 0 — Documentação Técnica

Resumo
-
Este repositório contém um exemplo fullstack (frontend + backend) demonstrando autenticação segura com tokens JWT (access + refresh), refresh token rotation e testes automatizados. É pensado como um boilerplate para aprender e testar fluxos de autenticação modernos.

Stack Tecnológica
-
- Backend: Node.js + Express
- Autenticação: JWT (access + refresh tokens)
- Hash de senhas: bcrypt
- Testes backend: Jest
- Frontend: Vite + React
- Testes frontend: Jest + React Testing Library

Arquitetura & Fluxo de Autenticação
-
- O backend expõe endpoints de autenticação (login, refresh, logout) e rotas protegidas.
- Após o login bem-sucedido o servidor emite um access token (curta duração) e um refresh token (maior duração). O access token é usado para autenticar chamadas à API. O refresh token é persistido em cookie httpOnly e pode ser trocado por um novo access token quando necessário.
- É recomendada a rotação/invalidação dos refresh tokens (ver `auth/` no backend). Em produção configurar `secure: true` nos cookies e servir via HTTPS.

Estrutura do Projeto
-
```
/
	package.json (monorepo scripts)
	README COMPLETO – Documentação Técnica
	backend/
		package.json
		src/
			app.js
			server.js
			db.js
			config.js
			seed.js
			protected.routes.js
			auth/
				auth.controller.js
				auth.service.js
				auth.routes.js
				auth.middleware.js
		jest.config.js
	frontend/
		package.json
		src/
			main.jsx
			App.jsx
			index.css
			auth/
				api.js
				AuthContext.jsx
				Login.jsx
				PrivateRoute.jsx
			pages/
				Dashboard.jsx
		vite.config.js
		jest.config.js
```

Pré-requisitos
-
- Node.js 18+ e npm
- Git (para sincronizar com o GitHub)

Variáveis de ambiente (exemplo para o backend `.env`)
-
- `PORT=4000`
- `DATABASE_URL=` (opcional, conforme implementação do `db.js`)
- `JWT_SECRET=` (segredo para access tokens)
- `REFRESH_TOKEN_SECRET=` (segredo para refresh tokens)
- `ACCESS_TOKEN_EXPIRES_IN=15m`
- `REFRESH_TOKEN_EXPIRES_IN=7d`

Para o frontend (exemplo `.env` ou Vite):
-
- `VITE_API_URL=http://localhost:4000`

Instalação e execução (desenvolvimento)
-
1. Instalar dependências do backend

```bash
cd backend
npm install
```

2. Popular dados iniciais (seed)

```bash
npm run seed
```

3. Iniciar backend

```bash
npm run dev   # ou npm start, conforme scripts no package.json do backend
```

4. Frontend

```bash
cd ../frontend
npm install
npm run dev
```

Padrões de portas (por exemplo)
-
- Frontend: http://localhost:3000
- Backend: http://localhost:4000

Scripts úteis (exemplos)
-
- Backend: `npm run dev` (inicia em modo desenvolvimento), `npm start` (produção), `npm run seed`, `npm test`
- Frontend: `npm run dev`, `npm run build`, `npm run preview`, `npm test`

Testes
-
- Rodar testes do backend:
```
cd backend
npm test
```
- Rodar testes do frontend:
```
cd frontend
npm test
```

Notas de segurança e produção
-
- Utilize HTTPS em produção e ajuste o cookie de refresh token com `secure: true` e `sameSite` apropriado.
- Garanta que `JWT_SECRET` e `REFRESH_TOKEN_SECRET` sejam segredos fortes e armazenados em um cofre (ex.: GitHub Secrets, Vault).
- Considere limitar o uso de refresh tokens e guardar um identificador no banco para permitir revogação.

-Deploy & CI
-
- Este projeto é agnóstico ao provedor. Exemplos: Heroku, Vercel (frontend), DigitalOcean, AWS. Configure variáveis de ambiente no ambiente de produção.

Integração contínua (exemplo GitHub Actions)
-
Adicione um workflow que instale dependências e rode os testes do `backend` e do `frontend`. Exemplo mínimo (`.github/workflows/ci.yml`):

```yaml
name: CI

on: [push, pull_request]

jobs:
	test:
		runs-on: ubuntu-latest
		steps:
			- uses: actions/checkout@v4
			- name: Setup Node
				uses: actions/setup-node@v4
				with:
					node-version: '18'
			- name: Cache node modules
				uses: actions/cache@v4
				with:
					path: |
						backend/node_modules
						frontend/node_modules
					key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
					restore-keys: |
						${{ runner.os }}-node-
			- name: Install backend deps
				run: |
					cd backend
					npm ci
			- name: Install frontend deps
				run: |
					cd frontend
					npm ci
			- name: Run backend tests
				run: |
					cd backend
					npm test
			- name: Run frontend tests
				run: |
					cd frontend
					npm test
```

Dicas para erros comuns de testes
-
- Jest ESM / `import` em testes: Se seus testes usam `import` (ES modules), configure o Jest para ESM ou use `babel-jest`. Duas abordagens:
	- Instalar e configurar `babel-jest` e adicionar um transform em `jest.config.js`.
	- Usar a opção `extensionsToTreatAsEsm` e ajustar `type: "module"` no `package.json` (veja a doc do Jest sobre ESM).
- `jest-environment-jsdom` faltando: a partir do Jest 28 o `jsdom` não vem mais embutido; instale `jest-environment-jsdom` no `frontend` com `npm install -D jest-environment-jsdom` ou ajuste `testEnvironment` em `jest.config.js`.
- Em resumo: para compatibilidade rápida, adicione no `frontend` devDependencies `babel-jest`, `@babel/preset-env`, `@babel/preset-react` (se usar JSX) e crie um `.babelrc` ou `babel.config.js` para permitir transformação dos testes.

Configuração de segredos e variáveis
-
- Defina variáveis sensíveis (ex.: `JWT_SECRET`, `REFRESH_TOKEN_SECRET`, `DATABASE_URL`) como GitHub Secrets e use-as no workflow quando for necessário para testes/integração em ambiente fechado.
-
- Este projeto é agnóstico ao provedor. Exemplos: Heroku, Vercel (frontend), DigitalOcean, AWS. Configure variáveis de ambiente no ambiente de produção.

-Contribuindo
-
- Abra issues para bugs ou features.
- Envie PRs com descrições claras e testes quando aplicável.

Licença
-
- Adicione aqui a licença do projeto.

Referências
-
- Veja os módulos em `backend/auth/` para detalhes de implementação de tokens e middleware.

--
Esta documentação foi atualizada automaticamente para detalhar instruções técnicas e operação do projeto.

